#!/bin/bash

DATA_FILE="$(dirname "$0")/data.json"
[ -f "$DATA_FILE" ] || { echo "data.json not found at $DATA_FILE"; exit 1; }

jq -r '. | "\(.name)\t\(.height)\t\(.weight)\t\(.types|map(.type.name)|join(", "))"' "$DATA_FILE" \
| awk -F'\t' '
  # define helper function at top-level for portability
  function fmt(x) { s = sprintf("%.1f", x); sub(/\.0$/,"",s); return s }

  {
    name=$1; height=$2; weight=$3; types=$4;
    # Capitalize name
    name = toupper(substr(name,1,1)) substr(name,2);
    # Capitalize each type
    n = split(types, a, ", ");
    for(i=1;i<=n;i++){
      a[i] = toupper(substr(a[i],1,1)) substr(a[i],2);
    }
    types_s = a[1];
    for(i=2;i<=n;i++) types_s = types_s ", " a[i];
    # convert decimeters -> meters, hectograms -> kg
    h = height/10; w = weight/10;
    printf "%s is of type %s, weighs %skg, and is %sm tall.\n", name, types_s, fmt(w), fmt(h);
  }' \
| sed -E 's/[[:space:]]+/ /g'
